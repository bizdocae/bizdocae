<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BizDoc OCR</title>
<style>
body{font-family:system-ui,Arial,sans-serif;max-width:900px;margin:40px auto;padding:0 16px;}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
input,select,button,textarea{font-size:16px;padding:10px;}
input,select,button{height:44px;}
button{cursor:pointer;border:1px solid #ccc;border-radius:10px;background:#111;color:#fff}
button:disabled{opacity:.6;cursor:not-allowed}
.muted{color:#666;font-size:14px}
textarea{width:100%;height:280px;white-space:pre-wrap;}
label{font-weight:600}
</style>
</head>
<body>
<h1>BizDoc OCR</h1>
<p class="muted">Paste a PDF/Image URL (supports Arabic + English). Choose a language or keep <b>Auto</b>.</p>
<div class="row">
  <input id="fileUrl" type="url" placeholder="https://example.com/file.pdf or .jpg" style="flex:1;min-width:260px" />
  <select id="language">
    <option value="auto">Auto (Engine 2)</option>
    <option value="ara">Arabic (ara)</option>
    <option value="eng">English (eng)</option>
  </select>
</div>
<div class="row" style="margin-top:10px">
  <button id="btnJson">Analyze (JSON)</button>
  <button id="btnPdf">Analyze & Download PDF</button>
  <label style="margin-left:12px"><input id="hideText" type="checkbox" checked /> Hide text layer in PDF</label>
</div>
<p class="muted" id="status" style="margin-top:10px;"></p>
<label for="output" style="display:block;margin-top:14px;">Extracted Text (preview):</label>
<textarea id="output" placeholder="Result text will appear here…"></textarea>
<script>
const q=s=>document.querySelector(s);
const fileUrl=q('#fileUrl'),language=q('#language'),hideText=q('#hideText');
const statusEl=q('#status'),out=q('#output'),btnJson=q('#btnJson'),btnPdf=q('#btnPdf');
function busy(b){btnJson.disabled=b;btnPdf.disabled=b;statusEl.textContent=b?'Processing…':'';}

btnJson.addEventListener('click',async()=>{
  const url=fileUrl.value.trim();if(!url)return alert('Please paste a file URL first.');busy(true);
  try{
    const resp=await fetch('/api/ocr-ocrspace',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url,language:language.value,wantText:true,wantSearchablePdf:true})});
    const data=await resp.json();if(!resp.ok||!data.ok)throw new Error(data.error||'OCR failed');
    out.value=data.text||'';statusEl.textContent=data.pdfUrl?'Searchable PDF created (temporary). Use the PDF button to download.':'Done.';
  }catch(e){out.value='';statusEl.textContent='Error: '+e.message;}finally{busy(false);}
});

btnPdf.addEventListener('click',async()=>{
  const url=fileUrl.value.trim();if(!url)return alert('Please paste a file URL first.');busy(true);
  try{
    const resp=await fetch('/api/ocr-ocrspace-pdf',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url,language:language.value,hideText:hideText.checked})});
    if(!resp.ok){const err=await safeJson(resp);throw new Error(err?.error||('HTTP '+resp.status));}
    const blob=await resp.blob();const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='ocr.pdf';
    document.body.appendChild(a);a.click();URL.revokeObjectURL(a.href);a.remove();statusEl.textContent='Downloaded.';
  }catch(e){statusEl.textContent='Error: '+e.message;}finally{busy(false);}
});
async function safeJson(r){try{return await r.json();}catch{return null;}}
</script>
</body>
</html>
